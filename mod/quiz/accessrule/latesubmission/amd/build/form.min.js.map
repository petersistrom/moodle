{"version":3,"sources":["../src/form.js"],"names":["Selectors","timedue","timeclose","timedueselector","init","lateperiod","holiday","click","is","trigger","calculate_close_date","on","timeduevalue","get_date","timeduedate","Date","year","month","day","hour","minute","timeduetimestamp","getTime","timeclosetimestamp","temptimestamp","getDay","holidaydates","split","forEach","element","timeclosedate","set_date","elementName","value","val","newvalue","getDate","getMonth","getFullYear","getHours","getMinutes"],"mappings":"qMAAA,uD,GAEMA,CAAAA,CAAS,CAAG,CACdC,OAAO,CAAE,qBADK,CAEdC,SAAS,CAAE,uBAFG,CAGdC,eAAe,CAAE,yBAHH,C,CAMLC,CAAI,CAAG,WAA2B,IAAzBC,CAAAA,CAAyB,GAAzBA,UAAyB,CAAbC,CAAa,GAAbA,OAAa,CACvCL,CAAO,CAAG,cAAOD,CAAS,CAACC,OAAjB,CAD6B,CAE3CA,CAAO,CAACM,KAAR,CAAc,UAAW,CACrB,GAAGN,CAAO,CAACO,EAAR,CAAW,UAAX,CAAH,CAA2B,CAEvB,GAAI,CAACN,CAAS,CAACM,EAAV,CAAa,UAAb,CAAL,CAA+B,CAC3BN,CAAS,CAACO,OAAV,CAAkB,OAAlB,CACH,CACDC,CAAoB,CAACL,CAAD,CAAaC,CAAb,CACvB,CACJ,CARD,EAUA,GAAIJ,CAAAA,CAAS,CAAG,cAAOF,CAAS,CAACE,SAAjB,CAAhB,CACAA,CAAS,CAACK,KAAV,CAAgB,UAAW,CAEvB,GAAG,CAACL,CAAS,CAACM,EAAV,CAAa,UAAb,CAAD,EAA6BP,CAAO,CAACO,EAAR,CAAW,UAAX,CAAhC,CAAyD,CAErDP,CAAO,CAACQ,OAAR,CAAgB,OAAhB,CACH,CACJ,CAND,EAQA,GAAIN,CAAAA,CAAe,CAAG,cAAOH,CAAS,CAACG,eAAjB,CAAtB,CACAA,CAAe,CAACQ,EAAhB,CAAmB,QAAnB,CAA6B,UAAW,CACpCD,CAAoB,CAACL,CAAD,CAAaC,CAAb,CACvB,CAFD,CAGH,C,UAEM,GAAMI,CAAAA,CAAoB,CAAG,SAACL,CAAD,CAAaC,CAAb,CAAyB,IAGrDM,CAAAA,CAAY,CAAGC,CAAQ,CAAC,SAAD,CAH8B,CAIrDC,CAAW,CAAG,GAAIC,CAAAA,IAAJ,CACVH,CAAY,CAACI,IADH,CAEVJ,CAAY,CAACK,KAAb,CAAqB,CAFX,CAGVL,CAAY,CAACM,GAHH,CAIVN,CAAY,CAACO,IAJH,CAKVP,CAAY,CAACQ,MALH,CAMV,CANU,CAJuC,CAWrDC,CAAgB,CAAGP,CAAW,CAACQ,OAAZ,EAXkC,CAYrDC,CAAkB,CAAGF,CAAgB,CAAiB,GAAb,CAAAhB,CAZY,CAerDmB,CAAa,CAAGH,CAfqC,CAgBzD,MAAOG,CAAa,CAAGD,CAAvB,CAA2C,CACvCC,CAAa,EAAI,KAAjB,CACA,GAAIN,CAAAA,CAAG,CAAG,GAAIH,CAAAA,IAAJ,CAASS,CAAT,EAAwBC,MAAxB,EAAV,CACA,GAAW,CAAP,EAAAP,CAAG,EAAgB,CAAP,EAAAA,CAAhB,CAA0B,CACtBK,CAAkB,EAAI,KACzB,CACJ,CAGD,GAAIG,CAAAA,CAAY,CAAGpB,CAAO,CAACqB,KAAR,CAAc,GAAd,CAAnB,CACAD,CAAY,CAACE,OAAb,CAAqB,SAAAC,CAAO,CAAI,CAC5BA,CAAO,CAAa,GAAV,CAAAA,CAAV,CACA,GAAIA,CAAO,EAAIR,CAAX,EAA+BQ,CAAO,CAAGN,CAA7C,CAAiE,CAC7DA,CAAkB,EAAI,KACzB,CACJ,CALD,EAOA,GAAIO,CAAAA,CAAa,CAAG,GAAIf,CAAAA,IAAJ,CAASQ,CAAT,CAApB,CACAQ,CAAQ,CAAC,WAAD,CAAcD,CAAd,CACX,CAnCM,C,yBAqCA,GAAMjB,CAAAA,CAAQ,CAAG,SAACmB,CAAD,CAAiB,CACrC,GAAIC,CAAAA,CAAK,CAAG,CACR,IAAO,cAAO,WAAYD,CAAZ,CAA0B,UAAjC,EAA4CE,GAA5C,EADC,CAER,MAAS,cAAO,WAAYF,CAAZ,CAA0B,YAAjC,EAA8CE,GAA9C,EAFD,CAGR,KAAQ,cAAO,WAAYF,CAAZ,CAA0B,WAAjC,EAA6CE,GAA7C,EAHA,CAIR,KAAQ,cAAO,WAAYF,CAAZ,CAA0B,WAAjC,EAA6CE,GAA7C,EAJA,CAKR,OAAU,cAAO,WAAYF,CAAZ,CAA0B,aAAjC,EAA+CE,GAA/C,EALF,CAAZ,CAOA,MAAOD,CAAAA,CACV,CATM,C,aAWA,GAAMF,CAAAA,CAAQ,CAAG,SAACC,CAAD,CAAcG,CAAd,CAA2B,CAC/C,cAAO,WAAYH,CAAZ,CAA0B,UAAjC,EAA4CE,GAA5C,CAAgDC,CAAQ,CAACC,OAAT,EAAhD,EACA,cAAO,WAAYJ,CAAZ,CAA0B,YAAjC,EAA8CE,GAA9C,CAAkDC,CAAQ,CAACE,QAAT,GAAsB,CAAxE,EACA,cAAO,WAAYL,CAAZ,CAA0B,WAAjC,EAA6CE,GAA7C,CAAiDC,CAAQ,CAACG,WAAT,EAAjD,EACA,cAAO,WAAYN,CAAZ,CAA0B,WAAjC,EAA6CE,GAA7C,CAAiDC,CAAQ,CAACI,QAAT,EAAjD,EACA,cAAO,WAAYP,CAAZ,CAA0B,aAAjC,EAA+CE,GAA/C,CAAmDC,CAAQ,CAACK,UAAT,EAAnD,CACH,CANM,C","sourcesContent":["import jQuery from 'jquery';\n\nconst Selectors = {\n    timedue: \"#id_timedue_enabled\",\n    timeclose: \"#id_timeclose_enabled\",\n    timedueselector: \"select[id^=id_timedue_]\",\n};\n\nexport const init = ({lateperiod, holiday}) => {\n    let timedue = jQuery(Selectors.timedue);\n    timedue.click(function() {\n        if(timedue.is(':checked')) {\n            // Enable timeclose when timedue is enabled.\n            if (!timeclose.is(':checked')) {\n                timeclose.trigger('click');\n            }\n            calculate_close_date(lateperiod, holiday);\n        }\n    });\n\n    let timeclose = jQuery(Selectors.timeclose);\n    timeclose.click(function() {\n        // Disable timedue when timeclose is disabled.\n        if(!timeclose.is(':checked') && timedue.is(':checked') ) {\n            // Timedue is unchecked, this ensures that the timeclose is not triggered 'click'. Hence dose not cause infinite loop.\n            timedue.trigger('click');\n        }\n    });\n\n    let timedueselector = jQuery(Selectors.timedueselector);\n    timedueselector.on('change', function() {\n        calculate_close_date(lateperiod, holiday);\n    });\n};\n\nexport const calculate_close_date = (lateperiod, holiday) => {\n    // The lateperiod and holiday are unit timestamp, in seconds.\n    // Javascript timestamp value is milliseconds.\n    let timeduevalue = get_date('timedue');\n    let timeduedate = new Date(\n            timeduevalue.year,\n            timeduevalue.month - 1, // The month selector start from 1 instead of 0.\n            timeduevalue.day,\n            timeduevalue.hour,\n            timeduevalue.minute,\n            0);\n    let timeduetimestamp = timeduedate.getTime();\n    let timeclosetimestamp = timeduetimestamp + (lateperiod * 1000);\n\n    //Skips weekends.\n    let temptimestamp = timeduetimestamp;\n    while (temptimestamp < timeclosetimestamp) {\n        temptimestamp += 86400000;\n        let day = new Date(temptimestamp).getDay();\n        if (day == 6 || day == 0) {\n            timeclosetimestamp += 86400000;\n        }\n    }\n\n    // Skip holidays.\n    let holidaydates = holiday.split(',');\n    holidaydates.forEach(element => {\n        element = element * 1000;\n        if (element >= timeduetimestamp && element < timeclosetimestamp) {\n            timeclosetimestamp += 86400000;\n        }\n    });\n\n    let timeclosedate = new Date(timeclosetimestamp);\n    set_date('timeclose', timeclosedate);\n};\n\nexport const get_date = (elementName) => {\n    let value = {\n        'day': jQuery('[name=\"' + elementName + '[day]\"]').val(),\n        'month': jQuery('[name=\"' + elementName + '[month]\"]').val(),\n        'year': jQuery('[name=\"' + elementName + '[year]\"]').val(),\n        'hour': jQuery('[name=\"' + elementName + '[hour]\"]').val(),\n        'minute': jQuery('[name=\"' + elementName + '[minute]\"]').val(),\n     };\n    return value;\n};\n\nexport const set_date = (elementName, newvalue) => {\n    jQuery('[name=\"' + elementName + '[day]\"]').val(newvalue.getDate());\n    jQuery('[name=\"' + elementName + '[month]\"]').val(newvalue.getMonth() + 1);\n    jQuery('[name=\"' + elementName + '[year]\"]').val(newvalue.getFullYear());\n    jQuery('[name=\"' + elementName + '[hour]\"]').val(newvalue.getHours());\n    jQuery('[name=\"' + elementName + '[minute]\"]').val(newvalue.getMinutes());\n};\n"],"file":"form.min.js"}