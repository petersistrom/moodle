{"version":3,"file":"form.min.js","sources":["../src/form.js"],"sourcesContent":["const Selectors = {\n    timedue: \"#id_timedue_enabled\",\n    timeclose: \"#id_timeclose_enabled\",\n    timedueselector: \"select[id^=id_timedue_]\",\n};\n\nexport const init = ({lateperiod, holiday}) => {\n    let timedue = document.querySelector(Selectors.timedue);\n    timedue.addEventListener(\"click\", function() {\n        if (timedue.checked) {\n            // Enable timeclose when timedue is enabled.\n            if (!timeclose.checked) {\n                timeclose.click();\n            }\n            calculateCloseDate(lateperiod, holiday);\n        }\n    });\n\n    let timeclose = document.querySelector(Selectors.timeclose);\n    timeclose.addEventListener(\"click\", function() {\n        // Disable timedue when timeclose is disabled.\n        if (!timeclose.checked && timedue.checked) {\n            // Timedue is unchecked, this ensures that the timeclose is not triggered 'click'. Hence dose not cause infinite loop.\n            timedue.click();\n        }\n    });\n\n    let timedueselector = document.querySelector(Selectors.timedueselector);\n    timedueselector.addEventListener(\"change\", function() {\n        calculateCloseDate(lateperiod, holiday);\n    });\n};\n\nexport const calculateCloseDate = (lateperiod, holiday) => {\n    // The lateperiod and holiday are unit timestamp, in seconds.\n    // Javascript timestamp value is milliseconds.\n    const DAYSECS = 86400000;\n    let timeduevalue = getDate('timedue');\n    let timeduedate = new Date(\n            timeduevalue.year,\n            timeduevalue.month - 1, // The month selector start from 1 instead of 0.\n            timeduevalue.day,\n            timeduevalue.hour,\n            timeduevalue.minute,\n            0);\n    let timeduetimestamp = timeduedate.getTime();\n    let timeclosetimestamp = timeduetimestamp + (lateperiod * 1000);\n\n    // Skips weekends.\n    let temptimestamp = timeduetimestamp;\n    while (temptimestamp < timeclosetimestamp) {\n        temptimestamp += 86400000;\n        let day = new Date(temptimestamp).getDay();\n        if (day == 6 || day == 0) {\n            timeclosetimestamp += DAYSECS;\n        }\n    }\n\n    // Skip holidays.\n    let holidaydates = holiday.split(',');\n    holidaydates.forEach(element => {\n        element = element * 1000;\n        if (element >= timeduetimestamp && element < timeclosetimestamp) {\n            timeclosetimestamp += 86400000;\n        }\n    });\n\n    let timeclosedate = new Date(timeclosetimestamp);\n    setDate('timeclose', timeclosedate);\n};\n\nexport const getDate = (elementName) => {\n    let value = {\n        'day': document.querySelector('[name=\"' + elementName + '[day]\"]').value,\n        'month': document.querySelector('[name=\"' + elementName + '[month]\"]').value,\n        'year': document.querySelector('[name=\"' + elementName + '[year]\"]').value,\n        'hour': document.querySelector('[name=\"' + elementName + '[hour]\"]').value,\n        'minute': document.querySelector('[name=\"' + elementName + '[minute]\"]').value,\n     };\n    return value;\n};\n\nexport const setDate = (elementName, newvalue) => {\n    document.querySelector('[name=\"' + elementName + '[day]\"]').value = newvalue.getDate();\n    document.querySelector('[name=\"' + elementName + '[month]\"]').value = newvalue.getMonth() + 1;\n    document.querySelector('[name=\"' + elementName + '[year]\"]').value = newvalue.getFullYear();\n    document.querySelector('[name=\"' + elementName + '[hour]\"]').value = newvalue.getHours();\n    document.querySelector('[name=\"' + elementName + '[minute]\"]').value = newvalue.getMinutes();\n};\n"],"names":["Selectors","_ref","lateperiod","holiday","timedue","document","querySelector","addEventListener","checked","timeclose","click","calculateCloseDate","timeduevalue","getDate","timeduetimestamp","Date","year","month","day","hour","minute","getTime","timeclosetimestamp","temptimestamp","getDay","split","forEach","element","timeclosedate","setDate","elementName","value","newvalue","getMonth","getFullYear","getHours","getMinutes"],"mappings":"yNAAMA,kBACO,sBADPA,oBAES,wBAFTA,0BAGe,wCAGDC,WAACC,WAACA,WAADC,QAAaA,cAC1BC,QAAUC,SAASC,cAAcN,mBACrCI,QAAQG,iBAAiB,SAAS,WAC1BH,QAAQI,UAEHC,UAAUD,SACXC,UAAUC,QAEdC,mBAAmBT,WAAYC,iBAInCM,UAAYJ,SAASC,cAAcN,qBACvCS,UAAUF,iBAAiB,SAAS,YAE3BE,UAAUD,SAAWJ,QAAQI,SAE9BJ,QAAQM,WAIML,SAASC,cAAcN,2BAC7BO,iBAAiB,UAAU,WACvCI,mBAAmBT,WAAYC,mBAI1BQ,mBAAqB,CAACT,WAAYC,eAIvCS,aAAeC,QAAQ,WAQvBC,iBAPc,IAAIC,KACdH,aAAaI,KACbJ,aAAaK,MAAQ,EACrBL,aAAaM,IACbN,aAAaO,KACbP,aAAaQ,OACb,GAC2BC,UAC/BC,mBAAqBR,iBAAiC,IAAbZ,WAGzCqB,cAAgBT,sBACbS,cAAgBD,oBAAoB,CACvCC,eAAiB,UACbL,IAAM,IAAIH,KAAKQ,eAAeC,SACvB,GAAPN,KAAmB,GAAPA,MACZI,oBAlBQ,OAuBGnB,QAAQsB,MAAM,KACpBC,SAAQC,WACjBA,SAAoB,MACLb,kBAAoBa,QAAUL,qBACzCA,oBAAsB,cAI1BM,cAAgB,IAAIb,KAAKO,oBAC7BO,QAAQ,YAAaD,qEAGZf,QAAWiB,cACR,KACDzB,SAASC,cAAc,UAAYwB,YAAc,WAAWC,YAC1D1B,SAASC,cAAc,UAAYwB,YAAc,aAAaC,WAC/D1B,SAASC,cAAc,UAAYwB,YAAc,YAAYC,WAC7D1B,SAASC,cAAc,UAAYwB,YAAc,YAAYC,aAC3D1B,SAASC,cAAc,UAAYwB,YAAc,cAAcC,uCAKpEF,QAAU,CAACC,YAAaE,YACjC3B,SAASC,cAAc,UAAYwB,YAAc,WAAWC,MAAQC,SAASnB,UAC7ER,SAASC,cAAc,UAAYwB,YAAc,aAAaC,MAAQC,SAASC,WAAa,EAC5F5B,SAASC,cAAc,UAAYwB,YAAc,YAAYC,MAAQC,SAASE,cAC9E7B,SAASC,cAAc,UAAYwB,YAAc,YAAYC,MAAQC,SAASG,WAC9E9B,SAASC,cAAc,UAAYwB,YAAc,cAAcC,MAAQC,SAASI"}