{"version":3,"file":"form.min.js","sources":["../src/form.js"],"sourcesContent":["import jQuery from 'jquery';\n\nconst Selectors = {\n    timedue: \"#id_timedue_enabled\",\n    timeclose: \"#id_timeclose_enabled\",\n    timedueselector: \"select[id^=id_timedue_]\",\n};\n\nexport const init = ({lateperiod, holiday}) => {\n    let timedue = jQuery(Selectors.timedue);\n    timedue.click(function() {\n        if(timedue.is(':checked')) {\n            // Enable timeclose when timedue is enabled.\n            if (!timeclose.is(':checked')) {\n                timeclose.trigger('click');\n            }\n            calculate_close_date(lateperiod, holiday);\n        }\n    });\n\n    let timeclose = jQuery(Selectors.timeclose);\n    timeclose.click(function() {\n        // Disable timedue when timeclose is disabled.\n        if(!timeclose.is(':checked') && timedue.is(':checked') ) {\n            // Timedue is unchecked, this ensures that the timeclose is not triggered 'click'. Hence dose not cause infinite loop.\n            timedue.trigger('click');\n        }\n    });\n\n    let timedueselector = jQuery(Selectors.timedueselector);\n    timedueselector.on('change', function() {\n        calculate_close_date(lateperiod, holiday);\n    });\n};\n\nexport const calculate_close_date = (lateperiod, holiday) => {\n    // The lateperiod and holiday are unit timestamp, in seconds.\n    // Javascript timestamp value is milliseconds.\n    let timeduevalue = get_date('timedue');\n    let timeduedate = new Date(\n            timeduevalue.year,\n            timeduevalue.month - 1, // The month selector start from 1 instead of 0.\n            timeduevalue.day,\n            timeduevalue.hour,\n            timeduevalue.minute,\n            0);\n    let timeduetimestamp = timeduedate.getTime();\n    let timeclosetimestamp = timeduetimestamp + (lateperiod * 1000);\n\n    // Skips weekends.\n    let temptimestamp = timeduetimestamp;\n    while (temptimestamp < timeclosetimestamp) {\n        temptimestamp += 86400000;\n        let day = new Date(temptimestamp).getDay();\n        if (day == 6 || day == 0) {\n            timeclosetimestamp += 86400000;\n        }\n    }\n\n    // Skip holidays.\n    let holidaydates = holiday.split(',');\n    holidaydates.forEach(element => {\n        element = element * 1000;\n        if (element >= timeduetimestamp && element < timeclosetimestamp) {\n            timeclosetimestamp += 86400000;\n        }\n    });\n\n    let timeclosedate = new Date(timeclosetimestamp);\n    set_date('timeclose', timeclosedate);\n};\n\nexport const get_date = (elementName) => {\n    let value = {\n        'day': jQuery('[name=\"' + elementName + '[day]\"]').val(),\n        'month': jQuery('[name=\"' + elementName + '[month]\"]').val(),\n        'year': jQuery('[name=\"' + elementName + '[year]\"]').val(),\n        'hour': jQuery('[name=\"' + elementName + '[hour]\"]').val(),\n        'minute': jQuery('[name=\"' + elementName + '[minute]\"]').val(),\n     };\n    return value;\n};\n\nexport const set_date = (elementName, newvalue) => {\n    jQuery('[name=\"' + elementName + '[day]\"]').val(newvalue.getDate());\n    jQuery('[name=\"' + elementName + '[month]\"]').val(newvalue.getMonth() + 1);\n    jQuery('[name=\"' + elementName + '[year]\"]').val(newvalue.getFullYear());\n    jQuery('[name=\"' + elementName + '[hour]\"]').val(newvalue.getHours());\n    jQuery('[name=\"' + elementName + '[minute]\"]').val(newvalue.getMinutes());\n};\n"],"names":["Selectors","_ref","lateperiod","holiday","timedue","click","is","timeclose","trigger","calculate_close_date","on","timeduevalue","get_date","timeduetimestamp","Date","year","month","day","hour","minute","getTime","timeclosetimestamp","temptimestamp","getDay","split","forEach","element","timeclosedate","set_date","elementName","val","newvalue","getDate","getMonth","getFullYear","getHours","getMinutes"],"mappings":"8SAEMA,kBACO,sBADPA,oBAES,wBAFTA,0BAGe,wCAGDC,WAACC,WAACA,WAADC,QAAaA,cAC1BC,SAAU,mBAAOJ,mBACrBI,QAAQC,OAAM,WACPD,QAAQE,GAAG,cAELC,UAAUD,GAAG,aACdC,UAAUC,QAAQ,SAEtBC,qBAAqBP,WAAYC,iBAIrCI,WAAY,mBAAOP,qBACvBO,UAAUF,OAAM,YAERE,UAAUD,GAAG,aAAeF,QAAQE,GAAG,aAEvCF,QAAQI,QAAQ,aAIF,mBAAOR,2BACbU,GAAG,UAAU,WACzBD,qBAAqBP,WAAYC,mBAI5BM,qBAAuB,CAACP,WAAYC,eAGzCQ,aAAeC,SAAS,WAQxBC,iBAPc,IAAIC,KACdH,aAAaI,KACbJ,aAAaK,MAAQ,EACrBL,aAAaM,IACbN,aAAaO,KACbP,aAAaQ,OACb,GAC2BC,UAC/BC,mBAAqBR,iBAAiC,IAAbX,WAGzCoB,cAAgBT,sBACbS,cAAgBD,oBAAoB,CACvCC,eAAiB,UACbL,IAAM,IAAIH,KAAKQ,eAAeC,SACvB,GAAPN,KAAmB,GAAPA,MACZI,oBAAsB,OAKXlB,QAAQqB,MAAM,KACpBC,SAAQC,WACjBA,SAAoB,MACLb,kBAAoBa,QAAUL,qBACzCA,oBAAsB,cAI1BM,cAAgB,IAAIb,KAAKO,oBAC7BO,SAAS,YAAaD,yEAGbf,SAAYiB,cACT,MACD,mBAAO,UAAYA,YAAc,WAAWC,aAC1C,mBAAO,UAAYD,YAAc,aAAaC,YAC/C,mBAAO,UAAYD,YAAc,YAAYC,YAC7C,mBAAO,UAAYD,YAAc,YAAYC,cAC3C,mBAAO,UAAYD,YAAc,cAAcC,yCAKpDF,SAAW,CAACC,YAAaE,gCAC3B,UAAYF,YAAc,WAAWC,IAAIC,SAASC,+BAClD,UAAYH,YAAc,aAAaC,IAAIC,SAASE,WAAa,uBACjE,UAAYJ,YAAc,YAAYC,IAAIC,SAASG,mCACnD,UAAYL,YAAc,YAAYC,IAAIC,SAASI,gCACnD,UAAYN,YAAc,cAAcC,IAAIC,SAASK"}